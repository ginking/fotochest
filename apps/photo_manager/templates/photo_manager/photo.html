{% extends "photo_manager/base.html" %}
{% block nav %}
{% include "photo_manager/nav.html" with current=2 %}
{% endblock nav %}
{% block extra_head %}
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
  function initialize() {
    var blackStyles = [
{
featureType: 'all',
rules: [
{visibility: 'off'}
]
},
{
featureType: 'water',
rules: [
{visibility: 'on'},
{lightness: -100 }
]
}
];
    var blackMapType = new google.maps.StyledMapType(blackStyles,
    {name: "Black Map"});

  
  
    var latlng = new google.maps.LatLng({{ photo.location.latitude }},{{ photo.location.longitude }} );
    var myOptions = {
      zoom: 3,
      center: latlng,
      
      mapTypeId: google.maps.MapTypeId.ROADMAP,
       styles: blackStyles,    
    };
    var map = new google.maps.Map(document.getElementById("small_map"),
        myOptions);

      //var bounds = new google.maps.LatLngBounds();

      
      var latlng{{ photo.id }} = new google.maps.LatLng({{ photo.location.latitude }}, {{ photo.location.longitude }});
      var marker{{ photo.id }} = new google.maps.Marker({
         position: latlng{{ photo.id }},
         map: map,
         title: "{{ photo.title }}"
      });

      var content{{ photo.id }} = '<div id="content">'+
          
          
          '<p>{{ photo.title }}</p>' +
          
          '</div>';
      var infowindow{{ photo.id }} = new google.maps.InfoWindow({
          content: content{{ photo.id }}
      });
      google.maps.event.addListener(marker{{ photo.id }}, 'click', function() {
         infowindow{{ photo.id }}.open(map, marker{{ photo.id }});
      });

      //bounds.extend(latlng{{ photo.id }})
 
        google.maps.event.addListener(map, 'mouseover', function() {
            map.setZoom(8);
        });
        google.maps.event.addListener(map, 'mouseout', function(){
            map.setZoom(3);
        });

      //map.fitBounds(bounds);    
      map.mapTypes.set('black_map', blackMapType);
      map.setMapTypeId('black_map');

  }
</script>
{% endblock extra_head %}
{% block extra_body %}onLoad="initialize()"{% endblock %}
{% block main_content %}
{% load comments %}

			<div class="span8" id="photo-detail">
			    <ul class="breadcrumb pull-right">
			        <li>
			            <a href="{% url homepage %}">Home</a> <span class="divider">/</span>
			        </li>
			        <li>
			            <a href="{{ photo.album.get_absolute_url }}">{{ photo.album }}</a> <span class="divider">/</span>
			        </li>
			        <li class="active">{{ photo.title }}</li>
			    </ul>

			<div class="btn-group photo-nav pull-left">
			    {% if photo.get_previous %}
				<a href="{{ photo.get_previous }}" class="btn"><i class="icon-arrow-left"></i> Previous</a>
				{% endif %}
				<a href="{% url photo_fullscreen album_slug=photo.album.slug photo_slug=photo.slug %}" class="btn"><i class="icon-picture"></i> Full Screen</a>
				{% if enable_download %}
				<a href="{% url photo_download photo_id=photo.id %}" class="btn"><i class="icon-download-alt"></i> Download Full Size</a>
				{% endif %}
				{% if photo.get_next %}
				<a href="{{ photo.get_next }}" class="btn">Next <i class="icon-arrow-right"></i></a>
			    {% endif %}
			</div>
				<div class="thumbnail">
				{% load thumbnail %}
				{% thumbnail photo.image "1024x650" quality=100 as im %}
				<!-- 1024x768-->
					<img src="{{ im.url }}">
				{% endthumbnail %}
				</div>
			</div>
			<div class="span4">
				<div class="well">
					<h3>{{ photo.title }}</h3>
					<div id="small_map"></div>
					<h6>By {{ photo.author }}</h6>
					<a href="{{ photo.album.get_absolute_url }}">From {{ photo.album }}</a>
					<p>This photo was uploaded on {{ photo.date_uploaded|date:"F j Y" }}, and taken in <a href="{% url photo_location location_slug=photo.location.slug %}">{{ photo.location.city }}, {{ photo.location.get_country_display }}</a>.</p>
					<h4>Other photos from <a href="{% url photo_location location_slug=photo.location.slug %}">{{ photo.location }}</a></h4>
					
					
					<ul class="thumbnails">
					{% for photo in photos_from_this_location %}
					{% load thumbnail %}
					{% thumbnail photo.image "75x75" crop="center" as im %}
					<li class="span1">
						<a href="{{ photo.get_absolute_url }}" class="thumbnail">
					<img src="{{ im.url }}" alt="">
					</a>
					</li>
					{% endthumbnail %}
					{% endfor %}
					</ul>
					
					
					
					<h4>Other photos from the <a href="{{ photo.album.get_absolute_url }}">{{ photo.album }} album</a></h4>
					<ul class="thumbnails">
					    {% for photo in other_photos %}
					        <li class="span1">
					            <a href="{{ photo.get_absolute_url }}" class="thumbnail">
					                {% load thumbnail %}
					                {% thumbnail photo.image "75x75" crop="center" quality=75 as im %}
					                <img src="{{ im.url }}">
					                {% endthumbnail %}
					            </a>
					        </li>
					    {% endfor %}
					</ul>
					</div>
				</div>
				<div class="span12 comments">
					<h3>Comments</h3>
					{% get_comment_list for photo as comment_list %}
					{% for comment in comment_list %}
					<div class="well {% if forloop.counter|divisibleby:2 %}odd{% endif %}">
					    <span class="author">{{ comment.user_name }}</span>
					    {% if comment.user %}
					    <span class="label label-info">Photographer</span>
					    {% endif %}
					    <p class="comment">
					        {{ comment.comment }}
					    </p>
					</div>
					{% endfor %}
					
				
			</div>
			<div class="span12">
			
			{% get_comment_form for photo as form %}
			  <form class="well" action="{% comment_form_target %}" method="post">
			    {% csrf_token %}
			    {{ form.content_type }}
			    {{ form.object_pk }}
			    
			    {{ form.timestamp }}
			    {{ form.security_hash }}
			    <label>Name:</label>
			    {{ form.name }}
			    <label>Email:</label>
			    {{ form.email }}
			    <label>URL:</label>
			    {{ form.url }}
			    <label>Comment</label>
			    <textarea name="comment" class="span11"></textarea>
			    <input type="hidden" value="{{ photo.get_absolute_url }}" name="next">
			    <div class="form-actions">
			        <input type="submit" name="submit" value="Post" class="btn btn-primary">
			        <input type="submit" name="preview" class="btn"	value="Preview">			  </form>
			    </div>
			</form>
			</div>
{% endblock main_content %}
